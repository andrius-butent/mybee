<?xml version="1.0" encoding="UTF-8"?>
<g:Grid xmlns="http://www.butent.com/column" xmlns:g="http://www.butent.com/grid"
        xmlns:ui="http://www.butent.com/ui" xmlns:xi="http://www.w3.org/2001/XInclude"

        name="TripCargo" viewName="TripCargo"
        editForm="CargoHandling"
        caption="=cargos" flexGrow="1"
>
  <g:columns>
    <RelColumn name="OrderNo" caption="=orderNumber" minWidth="100" editEnabled="true"
               editSource="Order" readOnly="true" />
    <RelColumn name="Customer" renderColumns="CustomerName" minWidth="100" editEnabled="true"
               editSource="Customer" readOnly="true" />
    <RelColumn name="Cargo" renderColumns="Cargo Description" editEnabled="true" maxWidth="300"
               editSource="Cargo" readOnly="true" />

    <DataColumn name="CargoType" label="=trCargoType"/>
    <DataColumn name="CargoGroup" label="=trCargoGroup"/>
    <DataColumn name="Weight" scale="0" editInPlace="true" />
    <DataColumn name="Volume" scale="0" editInPlace="true" />
    <DataColumn name="Quantity" scale="0" editInPlace="true" />
    <DataColumn name="Number" caption="=cargoNumber" editInPlace="true" />
    <DataColumn name="Cmr" caption="CMR" renderColumns="CmrName CmrNumber" />
    <DataColumn name="Notes" caption="=notes" whiteSpace="pre-wrap" editInPlace="true" />

    <DataColumn name="MultipleSegments" editInPlace="true" />

    <CalcColumn name="EstimateKm" type="integer" label="=trEstimateKm" visible="true" >
      <dynStyle>
        <ui:inline>color:red;</ui:inline>
        <ui:expression>(Number(row.LoadedKilometers) + Number(row.UnplannedManagerKm) + Number(row.EmptyKilometers))==0</ui:expression>
      </dynStyle>
      <render>
        <ui:expression>Number(row.LoadedKilometers) + Number(row.UnplannedManagerKm) + Number(row.EmptyKilometers)</ui:expression>
      </render>
    </CalcColumn>

    <CalcColumn name="Estimate" type="double" format="0.00" label="=trEstimate" visible="true" >
      <dynStyle>
        <ui:inline>color:red;</ui:inline>
        <ui:function>
          var estimate = Number(row.LoadedKilometers) + Number(row.UnplannedManagerKm) + Number(row.EmptyKilometers);
          if (estimate > 0 &amp;&amp; parseFloat(row.Income) > 0) {
          return false;
          } else {
          return true;
          }
        </ui:function>
      </dynStyle>
      <render>
        <ui:function>
          var estimate = Number(row.EmptyKilometers) + Number(row.LoadedKilometers) + Number(row.UnplannedManagerKm);
          if (estimate > 0) {
          return parseFloat(row.Income) / estimate;
          } else {
          return 0;
          }
        </ui:function>
      </render>
    </CalcColumn>

    <DataColumn name="TripPercent" horizontalAlignment="right">
      <style>
        <headerStyle>
          <ui:inline>font-weight:bold;</ui:inline>
        </headerStyle>
        <bodyStyle>
          <ui:inline>font-weight:bold;</ui:inline>
        </bodyStyle>
      </style>
      <dynStyle>
        <ui:inline>color:silver;</ui:inline>
        <ui:expression>row.TripPercent==null</ui:expression>
      </dynStyle>
      <render>
        <ui:expression>row.Income</ui:expression>
      </render>
    </DataColumn>

    <PropColumn name="CargoIncome" type="decimal" scale="2" caption="=trCargoIncomes" />

    <DataColumn name="CargoPercent" horizontalAlignment="right">
      <dynStyle>
        <ui:inline>color:silver;</ui:inline>
        <ui:expression>row.CargoPercent==null</ui:expression>
      </dynStyle>
      <render>
        <ui:expression>row.Expense</ui:expression>
      </render>
    </DataColumn>
  </g:columns>

  <xi:include href="columns/Places.columns.xml" />

  <g:columns>
    <RelColumn name="Trailer" viewName="UserVehicles" filter="IsTrailer" newRowEnabled="false"
               caching="local" editInPlace="true">
      <style>
        <headerStyle>
          <ui:inline>font-weight:bold;</ui:inline>
        </headerStyle>
        <bodyStyle>
          <ui:inline>font-weight:bold;</ui:inline>
        </bodyStyle>
      </style>
    </RelColumn>
    <DataColumn name="Message" readOnly="true" />
    <DataColumn name="Ordinal" visible="false" />

    <DataColumn name="InvoiceNo" caption="=trdInvoice" />
    <DataColumn name="Directions" editInPlace="true" />
    <DataColumn name="CmrCopy" caption="=trCmrCopy" editInPlace="true" />

    <DataColumn name="OrderStatus"/>

    <DataColumn name="CmrDate" format="DATE_TIME_SHORT" editInPlace="true" />
  </g:columns>
</g:Grid>
